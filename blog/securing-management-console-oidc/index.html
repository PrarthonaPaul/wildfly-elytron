<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Elytron: Securing the WildFly Management Console with OpenID Connect</title>
    <script src="/wildfly-elytron/assets/javascript/highlight.pack.js" type="text/javascript"></script>

    <link rel="shortcut icon" type="image/png" href="/wildfly-elytron/favicon.ico">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,500,700" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- We override the colours from this theme manually -->
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <link rel="stylesheet" href="/wildfly-elytron/assets/css/styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    <script src="/wildfly-elytron/assets/javascript/hl.js" type="text/javascript"></script>
    <link rel="alternate" type="application/rss+xml"  href="/wildfly-elytron/feed.xml" title="WildFly Elytron">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135301155-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-135301155-1');
    </script>
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Securing the WildFly Management Console with OpenID Connect | WildFly Elytron</title>
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Securing the WildFly Management Console with OpenID Connect" />
<meta name="author" content="Farah Juma" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="WildFly 29 Final, which was just released last week, includes the ability to secure the WildFly Management Console with OpenID Connect using the Keycloak OpenID provider. This blog post gives an overview of how to configure this." />
<meta property="og:description" content="WildFly 29 Final, which was just released last week, includes the ability to secure the WildFly Management Console with OpenID Connect using the Keycloak OpenID provider. This blog post gives an overview of how to configure this." />
<link rel="canonical" href="https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/" />
<meta property="og:url" content="https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/" />
<meta property="og:site_name" content="WildFly Elytron" />
<meta property="og:image" content="https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-07-24T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg" />
<meta property="twitter:title" content="Securing the WildFly Management Console with OpenID Connect" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Farah Juma"},"dateModified":"2023-07-24T00:00:00+00:00","datePublished":"2023-07-24T00:00:00+00:00","description":"WildFly 29 Final, which was just released last week, includes the ability to secure the WildFly Management Console with OpenID Connect using the Keycloak OpenID provider. This blog post gives an overview of how to configure this.","headline":"Securing the WildFly Management Console with OpenID Connect","image":"https://wildfly-security.github.io/wildfly-elytron/assets/images/wildfly-elytron-logo.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/"},"url":"https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>


<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
    <header class="mdl-layout__header mdl-layout__header--scroll">
        <div class="mdl-layout__header-row ">
            <!-- Title -->
            <span class="mdl-layout-title"><h3>Wild<strong>Fly</strong>  Elytron</h3></span>
            <!-- Add spacer, to align navigation to the right -->
            <div class="mdl-layout-spacer"></div>
            <nav class="mdl-navigation mdl-layout--large-screen-only">
                
                    
                    
                    
                         <a class="mdl-navigation__link highlight-button Contribute-menuitem" href="/wildfly-elytron/contribute/">Contribute</a>
                    
                
                    
                    
                    
                         <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
                    
                
                    
                    
                    
                         <a class="mdl-navigation__link Guides-menuitem" href="/wildfly-elytron/guides/">Guides</a>
                    
                
                    
                    
                    
                         <a class="mdl-navigation__link Docs-menuitem" href="/wildfly-elytron/docs/">Docs</a>
                    
                
                    
                    
                    
                         <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
                    
                
                    
                    
                    
                         <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
                    
                
                    
                    
                    
                         <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
                    
                
                    
                    
                    
                         <a class="mdl-navigation__link CVE Reporting-menuitem" href="/wildfly-elytron/security/">CVE Reporting</a>
                    
                
            </nav>
        </div>
    </header>
    <div class="mdl-layout__drawer">
        <div class="side-drawer-logo-container"><h3>Wild<strong>Fly</strong>  Elytron</h3></div>
        <nav class="mdl-navigation">
            
            
            
            
                <a class="mdl-navigation__link highlight-sidebar Contribute-menuitem" href="/wildfly-elytron/contribute/">Contribute</a>
            
            
            
            
            
                <a class="mdl-navigation__link Home-menuitem" href="/wildfly-elytron/">Home</a>
            
            
            
            
            
                <a class="mdl-navigation__link Guides-menuitem" href="/wildfly-elytron/guides/">Guides</a>
            
            
            
            
            
                <a class="mdl-navigation__link Docs-menuitem" href="/wildfly-elytron/docs/">Docs</a>
            
            
            
            
            
                <a class="mdl-navigation__link Community-menuitem" href="/wildfly-elytron/community/">Community</a>
            
            
            
            
            
                <a class="mdl-navigation__link mdl-navigation__link--current Blog-menuitem" href="/wildfly-elytron/blog/">Blog</a>
            
            
            
            
            
                <a class="mdl-navigation__link GitHub-menuitem" href="https://github.com/wildfly-security/wildfly-elytron">GitHub</a>
            
            
            
            
            
                <a class="mdl-navigation__link CVE Reporting-menuitem" href="/wildfly-elytron/security/">CVE Reporting</a>
            
            
            <!-- mdl-navigation__link--current -->
        </nav>
    </div>
    <main class="mdl-layout__content">
        <div class="page-content">
            
            <div class="content">
                <div class="post-page grid-wrapper">
  <div class="grid__item width-12-12 width-12-12-m doc-content">
    <h1>Securing the WildFly Management Console with OpenID Connect</h1>
    <div class="grid-wrapper">
      <div class="grid__item width-8-12 width-12-12-m byline-wrapper">
        
        
          <img class="headshot" src="https://www.gravatar.com/avatar/e07a676199f6ad0af96a61a691b114b3">
        
        <p class="byline">
          By <a href="https://github.com/fjuma">Farah Juma</a> | July 24, 2023
          <br>
          
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/oidc"> #oidc</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/management"> #management</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/console"> #console</a>
            
              <a style="font-size: 0.9em;" href="/wildfly-elytron/blog/tag/keycloak"> #keycloak</a>
            
          
        </p>
      </div>
      
      <div class="grid__item width-4-12 width-12-12-m"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/&title=Securing the WildFly Management Console with OpenID Connect" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <i class="fab fa-linkedin"></i>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=Securing the WildFly Management Console with OpenID Connect&url=https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/&via=WildFlyAS&related=WildFlyAS" rel="nofollow" target="_blank" title="Share on Twitter">
    <i class="fab fa-twitter-square"></i>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/" rel="nofollow" target="_blank" title="Share on Facebook">
    <i class="fab fa-facebook-square"></i>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <i class="fab fa-reddit-square"></i>
  </a>
  <a class="share-email" href="mailto:?subject=Securing the WildFly Management Console with OpenID Connect&amp;body=Securing the WildFly Management Console with OpenID Connect https://wildfly-security.github.io/wildfly-elytron/blog/securing-management-console-oidc/" title="Share via Email" >
    <i class="fas fa-envelope-square"></i>
  </a>
</div>
</div>
      <div class="grid__item width-12-12">
          <div class="paragraph">
<p>WildFly 29 Final, which was just released last week, includes the ability to secure the WildFly Management Console
with OpenID Connect using the Keycloak OpenID provider. This blog post gives an overview of how to configure this.</p>
</div>
<div id="toc" class="toc">
<div id="toctitle" class="title"></div>
<ul class="sectlevel1">
<li><a href="#openid-connect">OpenID Connect</a></li>
<li><a href="#securing-the-wildfly-management-console-with-the-keycloak-openid-provider">Securing the WildFly Management Console with the Keycloak OpenID Provider</a>
<ul class="sectlevel2">
<li><a href="#keycloak-configuration">Keycloak Configuration</a></li>
<li><a href="#elytron-oidc-client-subsystem-configuration">Elytron OIDC Client Subsystem Configuration</a></li>
<li><a href="#accessing-the-wildfly-management-console">Accessing the WildFly Management Console</a></li>
</ul>
</li>
<li><a href="#summary">Summary</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="openid-connect"><a class="anchor" href="#openid-connect"></a>OpenID Connect</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://openid.net/connect/">OpenID Connect</a> (OIDC) is an identity layer on top of the OAuth 2.0 protocol.
OpenID Connect makes it possible for a client to verify a user&#8217;s identity based on authentication
that&#8217;s performed by an OpenID provider.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="securing-the-wildfly-management-console-with-the-keycloak-openid-provider"><a class="anchor" href="#securing-the-wildfly-management-console-with-the-keycloak-openid-provider"></a>Securing the WildFly Management Console with the Keycloak OpenID Provider</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When the WildFly Management Console is secured using OIDC, this means that when a user attempts to
access the console, they will be redirected to the Keycloak OpenID provider&#8217;s login page. Upon successful
authentication, the user will then be redirected back to the WildFly Management Console.</p>
</div>
<div class="paragraph">
<p>To secure the WildFly Management Console with OIDC, there is configuration that needs to be added
on the Keycloak side and in the <code>elytron-oidc-client</code> subsystem configuration.</p>
</div>
<div class="sect2">
<h3 id="keycloak-configuration"><a class="anchor" href="#keycloak-configuration"></a>Keycloak Configuration</h3>
<div class="sect3">
<h4 id="set-up"><a class="anchor" href="#set-up"></a>Set up</h4>
<div class="paragraph">
<p>It&#8217;s easy to set up Keycloak using Docker. Follow the steps in Keycloak&#8217;s <a href="https://www.keycloak.org/getting-started/getting-started-docker">getting started guide</a>
to start Keycloak and create a realm called <code>wildfly-infra</code>.</p>
</div>
<div class="paragraph">
<p>Now, we&#8217;re going to create a client called <code>wildfly-console</code>. Set the <code>Valid Redirect URIs</code> using the URI used to access
the WildFly Management Console. Since we will use a port offset of 10 when starting WildFly in this post, we will
set the <code>Valid Redirect URIs</code> to <code><a href="http://localhost:10000/console/*" class="bare">http://localhost:10000/console/*</a></code>. Similarly, we can also set <code>Web Origins</code>
using the management port for our WildFly instance, e.g., <code><a href="http://localhost:10000" class="bare">http://localhost:10000</a></code>.</p>
</div>
<div class="paragraph">
<p>Next, create a second client called <code>wildfly-management</code>. This will be a bearer-only client so in the <code>Capability</code> configuration,
be sure to uncheck the <code>Standard flow</code> and <code>Direct access grants</code>.</p>
</div>
<div class="paragraph">
<p>Finally, create a user called <code>alice</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="optional-role-configuration"><a class="anchor" href="#optional-role-configuration"></a>Optional Role Configuration</h4>
<div class="paragraph">
<p>If you want to configure WildFly to use <a href="https://docs.wildfly.org/29/Admin_Guide.html#RBAC">Role Based Access Control</a> (RBAC),
you can create a new <code>Realm role</code> (e.g., <code>Administrator</code>) and assign this role to <code>alice</code>.</p>
</div>
<div class="paragraph">
<p>Steps for assigning roles can be found in the <a href="https://www.keycloak.org/docs/latest/server_admin/#proc-assigning-role-mappings_server_administration_guide">Keycloak documentation</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="elytron-oidc-client-subsystem-configuration"><a class="anchor" href="#elytron-oidc-client-subsystem-configuration"></a>Elytron OIDC Client Subsystem Configuration</h3>
<div class="paragraph">
<p>Now that we&#8217;ve configured our OpenID provider, there are a couple things that need to be configured in the
<code>elytron-oidc-client</code> subsystem to secure the WildFly Management Console with OIDC.</p>
</div>
<div class="paragraph">
<p>First, we need to add a <code>secure-deployment</code> resource that references the <code>wildfly-management</code> client that was created in the previous section.</p>
</div>
<div class="paragraph">
<p>A <code>secure-server</code> that references the <code>wildfly-console</code> client is also needed.</p>
</div>
<div class="paragraph">
<p>We can use the following commands to add the required configuration:</p>
</div>
<div class="paragraph">
<p>First, we need to start our WildFly server instance. Notice that we&#8217;re specifying a port offset here
since our Keycloak instance is already exposed on port 8080:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">./bin/standalone.sh -Djboss.socket.binding.port-offset=10</code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, we can connect to the WildFly CLI and then execute the commands below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">./bin/jboss-cli.sh --connect --controller=localhost:10000</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-shell hljs" data-lang="shell"># Configure the Keycloak provider
/subsystem=elytron-oidc-client/provider=keycloak:add(provider-url=http://localhost:8080/realms/wildfly-infra)

# Create a secure-deployment in order to secure the management interface with bearer token authentication
/subsystem=elytron-oidc-client/secure-deployment=wildfly-management:add(provider=keycloak,client-id=wildfly-management,principal-attribute=preferred_username,bearer-only=true,ssl-required=EXTERNAL)

# (Optional) Enable RBAC where roles are obtained from the identity
/core-service=management/access=authorization:write-attribute(name=provider,value=rbac)
/core-service=management/access=authorization:write-attribute(name=use-identity-roles,value=true)

# Create a secure-server to ensure that the WildFly Management Console will redirect to the Keycloak OpenID provider for log in
/subsystem=elytron-oidc-client/secure-server=wildfly-console:add(provider=keycloak,client-id=wildfly-console,public-client=true)

# reload
reload</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="accessing-the-wildfly-management-console"><a class="anchor" href="#accessing-the-wildfly-management-console"></a>Accessing the WildFly Management Console</h3>
<div class="paragraph">
<p>With the above configuration now in place, let&#8217;s access <a href="http://localhost:10000/console" class="bare">http://localhost:10000/console</a>. We will be redirected to
the Keycloak login page. We can log in using the <code>alice</code> user that we created earlier. Upon successful authentication,
we will be redirected back to the WildFly
Management Console.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This blog post has given an overview of how to secure the WildFly Management Console with OIDC using the
Elytron OIDC Client subsystem.</p>
</div>
</div>
</div>
      </div>
    </div>
  </div>
</div>

            </div>
        </div>
    </main>
</div>
</body>
</html>
